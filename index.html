<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wrap and Unwrap MON Token</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.6.8/dist/ethers.umd.min.js"></script>
</head>
<body>
    <h1>Wrap and Unwrap MON Token</h1>
    <p>Wrap MON Token into WMON and Unwrap WMON back to MON</p>

    <div>
        <h3>Wrap MON to WMON</h3>
        <input type="number" id="wrapAmount" placeholder="Amount of MON to wrap">
        <button onclick="wrapToken()">Wrap MON</button>
    </div>

    <div>
        <h3>Unwrap WMON to MON</h3>
        <input type="number" id="unwrapAmount" placeholder="Amount of WMON to unwrap">
        <button onclick="unwrapToken()">Unwrap WMON</button>
    </div>

    <script>
        let provider;
        let signer;
        let contract;
        
        // Địa chỉ của hợp đồng (thay đổi theo hợp đồng của bạn)
        const contractAddress = "0x276e9e7e1ad77ADf29B4a14a79D732AB2261Ce8C";

        // ABI của hợp đồng WMONWrapper (chỉ chứa các hàm wrap và unwrap)
        const contractABI = [
            "function wrap(uint256 _amountMON) public",
            "function unwrap(uint256 _amountWMON) public"
        ];

        async function connectWallet() {
            if (window.ethereum) {
                provider = new ethers.providers.Web3Provider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
                signer = provider.getSigner();
                contract = new ethers.Contract(contractAddress, contractABI, signer);
                console.log("Wallet connected!");
            } else {
                alert("MetaMask not found! Please install MetaMask.");
            }
        }

        async function wrapToken() {
            const wrapAmount = document.getElementById("wrapAmount").value;
            if (wrapAmount <= 0) {
                alert("Please enter a valid amount.");
                return;
            }

            await connectWallet();

            try {
                const tx = await contract.wrap(ethers.utils.parseUnits(wrapAmount, 18));  // Giả sử MON có 18 chữ số thập phân
                console.log("Transaction sent:", tx.hash);
                await tx.wait();  // Đợi giao dịch hoàn tất
                alert(`Successfully wrapped ${wrapAmount} MON into WMON!`);
            } catch (error) {
                console.error("Error wrapping MON:", error);
                alert("Error wrapping MON.");
            }
        }

        async function unwrapToken() {
            const unwrapAmount = document.getElementById("unwrapAmount").value;
            if (unwrapAmount <= 0) {
                alert("Please enter a valid amount.");
                return;
            }

            await connectWallet();

            try {
                const tx = await contract.unwrap(ethers.utils.parseUnits(unwrapAmount, 18));  // Giả sử WMON có 18 chữ số thập phân
                console.log("Transaction sent:", tx.hash);
                await tx.wait();  // Đợi giao dịch hoàn tất
                alert(`Successfully unwrapped ${unwrapAmount} WMON into MON!`);
            } catch (error) {
                console.error("Error unwrapping WMON:", error);
                alert("Error unwrapping WMON.");
            }
        }
    </script>
</body>
</html>
